window.DialogConnect=function(t){"use strict";let e,s,n;!t&&(t={}),!t.provider&&(t.provider="univaultoffice");var o={close:t.onclose},a=`<section>\n                            <div id="panel-portal" class="sl-panel">\n                                <div class='select-field dlg--option'>\n                                    <section class='box-cmp-select'>\n                                        <select class='combobox' data-size='5'></select>\n                                    </section>\n                                </div>\n                                <div class="error-box">\n                                    <p id="auth-error" class="msg-error">asd</p>\n                                    <input id="auth-portal" type="text" name="" spellcheck="false" class="tbox dlg--option" placeholder="${utils.Lang.pshPortal}" value="">\n                                </div>\n                                <div style="height:12px;"></div>\n                                <div class="lr-flex">\n                                    <a class="text-sub link newportal" target="popup" href="javascript:void(0)">${utils.Lang.linkCreatePortal}</a>\n                                    <span />\n                                    <div class="lr-flex">\n                                        <img class="img-loader">\n                                        <button id="btn-next" l10n class="btn btn--landing">${utils.Lang.btnConnect}</button>\n                                    </div>\n                                </div>\n                            </div>\n                        </section>`;function i(t,s){let o=e.find("#auth-error");t?(o.text(t).fadeIn(100),s&&n.find(s).addClass("error").focus()):(o.fadeOut(100),n.find(".error").removeClass("error"))}let l=i.bind(this,"");function r(t){c()}function c(t){e.remove(),o.close&&o.close(t)}function d(){l();let t=n.find("select").val(),e=n.find("#auth-portal").val(),s="https://";const o=config.portals.providers.find(t);if(o&&o.entryPage)return void c({portal:o.entryPage,provider:t});/^\s|\s$/.test(e)&&(e=e.trim(),n.find("#auth-portal").val(e));if(!e.length||/([\s\r\n\t\\]|%(?!\d{2}))/.test(e)||!/^(https?:\/\/)?([^@\/\s]{1,63})\/[^\s]*/.test(e+"/"))return void i(utils.Lang.errLoginPortal,"#auth-portal");if(e=/^(https?:\/{2})?([^\s\?\&]+)/i.exec(e),!e||!e[2].length)return void i(utils.Lang.errLoginPortal,"#auth-portal");e[1]&&(s=e[1]),e=e[2],e=e.replace(/\/+$/i,""),"owncloud"!=t&&"nextcloud"!=t||e.endsWith("/index.php/login")&&(e=e.slice(0,-16)),p(!0);let a=n=>{n&&("success"==n.status||"skipped"==n.status?(n.status,c({portal:s+e,provider:t})):i(utils.Lang.errLoginPortal,"#auth-portal")),p(!1)};f(s+e,t).then(a,(n=>"error"!=n.status||404!=n.response.status&&404!=n.response.statusCode?(a(n),n):(s="https://"==s?"http://":"https://",f(s+e,t)))).then(a,a)}function u(t){const e=config.portals.providers.find(t.target.value);if(e){const t=n.find("#auth-portal");e.entryPage?(t.data("autoportal")||t.data("userportal",t.val()),t.data("autoportal",!0),t[0].disabled=!0,t.val(e.entryPage)):(t.data("autoportal")&&(t.val(t.data("userportal")),t.data("autoportal",!1)),t[0].disabled=!1)}}function p(t){n.find(".tbox, #btn-login").prop("disabled",t),n.find(".img-loader")[t?"show":"hide"]()}function f(t,e){!e&&(e="univaultoffice");const s=config.portals.checklist.find((t=>t.provider==e));let n;return n=s?s.check.url?t+s.check.url:`no check url for ${e} found`:`no config for ${e} found`,new Promise(((t,e)=>{if(n.startsWith("http")){let o=$.ajax;window.AscSimpleRequest&&window.AscSimpleRequest.createRequest&&(o=window.AscSimpleRequest.createRequest),o({url:n,crossOrigin:!0,crossDomain:!0,timeout:1e4,headers:s.check.headers,complete:function(s,n){if("success"==n)try{t({status:n,response:s})}catch(t){s.status=404,e({status:"error",response:s})}else e({status:n,response:s})},error:function(s,n,o){302==s.responseStatus?t({status:"success",response:s}):(-102==s.statusCode&&(s.statusCode=404),e({status:n,response:s}))}})}else t({status:"skipped",response:{statusText:n}})}))}return{show:function(){var o;e=$("#placeholder").append('<dialog class="dlg dlg-connect-to">\n                        <div class="title">\n                            <label class="caption">Title</label>\n                            <span class="tool close"></span>\n                        </div>\n                        <div class="body"></div>\n                    </dialog>').find(".dlg-connect-to"),s=e.find(".title"),n=e.find(".body"),e.width(480),s.find(".tool.close").bind("click",r),o=utils.Lang.loginTitleStart,s.find(".caption").text(o),n.html(a);let i=e.find("select"),p=config.portals.checklist;if(1==p.length&&"univaultoffice"==p[0].provider)i.append("<option value='univaultoffice'>univaultoffice</option>"),i.parents(".select-field").hide();else{for(let t of p)i.append(`<option value='${t.provider}'>${t.name}</option>`);i.val(t.provider);let s=e.find(".newportal").disable(!("univaultoffice"==t.provider));i.on("change",(t=>{s.disable(!("univaultoffice"==t.target.value)),l()})),i.selectpicker(),i.on("change",u.bind(this)),i.trigger("change")}let f=n.find("#auth-portal");t.portal&&f.val(utils.skipUrlProtocol(t.portal)),n.find("#btn-next").on("click",d),n.on("keypress",".tbox",(function(t){13==t.which&&/auth-portal/.test(t.target.id)&&d()})),e.get(0).showModal(),e.addClass("scaled"),e.on("close",r),n.find(".newportal").one("click",(t=>{setTimeout((t=>c()),0)})),setTimeout((()=>{f.focus()}),50)},portalexists:f}};